
rule "SZ main sw"
when
    Channel "mqtt:topic:openhab:sz_up_remote:action" triggered
then
	var state = receivedEvent

    var curtainPos = 0
    try {
        curtainPos = Integer::parseInt(sz_curtain_switch.state.toString())
    } catch(Throwable t) {}

    switch(state) {
        case "on": {
            sz_up_light_dim.sendCommand(100)
        }
        case "off": {
            if (sz_up_light_sw.state == ON) {
                sz_up_light_sw.sendCommand(OFF)
            } else {
                sz_up_light_dim.sendCommand(1)
            }
        }
        case "arrow_right_click": {
            sz_bed_light_dim.sendCommand(10)
        }
        case "arrow_right_hold": {
            if (100 != curtainPos) {
                sz_curtain_switch.sendCommand("close")
            }
            sz_bed_light.sendCommand(ON)
            sz_bed_light_dim.sendCommand(50)
            Thread::sleep(3000)
            fl_light.sendCommand(OFF)
            sz_up_light_sw.sendCommand(OFF)
        }
        // Exit
        case "arrow_left_click": {
            sz_light.sendCommand(OFF)
        }
    }
end

rule "SZ main dimmer"
when
    Channel "mqtt:topic:openhab:sz_up_remote:action_dim" triggered
then
    if (sz_up_light_sw.state == ON) {
        sz_up_light_dim_fast.sendCommand((sz_up_light_dim_fast.state as Number) + Integer::parseInt(receivedEvent))
    }
    if (sz_bed_light.state == ON) {
        sz_bed_light_dim_fast.sendCommand((sz_bed_light_dim_fast.state as Number) + Integer::parseInt(receivedEvent))
    }
end

rule "SZ main sw (bed)"
when
    Channel "mqtt:topic:openhab:sz_bed_l_remote:action" triggered
then
	var state = receivedEvent
    switch(state) {
        case "play_pause": {
            all_light.sendCommand(OFF)
        }
        case "volume_up_hold": {
            sz_up_light_sw.sendCommand(ON)
            sz_up_light_dim.sendCommand(100)
        }
        case "volume_up": {
            sz_bed_light.sendCommand(ON)
            sz_bed_light_dim.sendCommand(100)
        }
        case "volume_down": {
            if (sz_light.state == ON && sz_bed_light_dim.state < 10) {
                sz_light.sendCommand(OFF)
            } else {
                sz_bed_light.sendCommand(ON)
                sz_bed_light_dim.sendCommand(1)
            }
        }
        // Control Blinds
        case "track_next": {
            sz_blinds_cmd.sendCommand("open")
        }
        case "dots_2_initial_press": {
            sz_blinds_cmd.sendCommand("close")
        }
        // Control Curtains
        case "track_previous": {
            sz_curtain_position.sendCommand(0)
        }
        case "dots_1_initial_press": {
            sz_curtain_position.sendCommand(100)
        }
    }
end

rule "SZ remote curtain"
when
    Channel "mqtt:topic:openhab:sz_curtain_remote:action" triggered
then
	var state = receivedEvent
    sz_curtain_switch.sendCommand(state)
end
