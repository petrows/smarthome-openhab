
var washMachineDetectedPower = 0

rule "Washmachine power"
when
    Item sonoffWMPower changed
then
	if (sonoffWMPower.state > 10) {
	
		// Initial signal should be > 100W
		// Initial signal should be >= 3 times in a row
		if (washMachinePower.state != ON) {
			if (sonoffWMPower.state < 100) {
				logWarn("washmachine", "Initial signal too low, igonring")
				return;
			}
			washMachineDetectedPower = washMachineDetectedPower + 1
			if (washMachineDetectedPower < 3) {
				logWarn("washmachine", "Initial signal repeated " + washMachineDetectedPower +" times, igonring")
				return;
			}
		}
		
		// Update the WM timer
		washMachinePower.sendCommand(ON)
	} else {
		washMachineDetectedPower = 0
	}
end
